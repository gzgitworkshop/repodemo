<!DOCTYPE html>
<!--[if IE 7]>         <html class="lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <title>mema</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="css/styles.min.css" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <script src="js/libs/json2.js"></script>
        <![endif]-->
    <link href="css/custom/videos/styles.css" rel="stylesheet" type="text/css">
    <style type="text/css">
    html, body {
        overflow-x : hidden;
    }
    #peek {
        width : 400px;
        float : right;
        position : absolute;
        left : -355px;
        background-color: #99FFCC;
        opacity: .75;
        padding: 1em;
        color: #003300;
        font-family:'Avenir LT W01 65 Medium', 'AvenirLTW01-65MediumObl', 'Avenir LT W01 85 Heavy', 'AvenirLTW01-85HeavyObli', 'Avenir', 'helvetica neue', helvetica, arial, sans-serif;
        font-weight: 300;
        z-index: 100;
    }
    .lLink {
        text-decoration: none !important;
    }
    #videos ul li.vid-thumb:nth-child(4) {
        margin-right: 0px;
    }
    </style>
</head>

<body>
    <div id="peek" class="ui-corner-bl" style="-webkit-user-select: none; -moz-user-select: none; -khtml-user-select: none; -ms-user-select: none;">
        <div style="font-weight: bold;">SELECT USER TYPE
            <button onclick="refreshRec()">refresh</button>
        </div>
        <hr />
        <div style="font-weight: bold;">SUBJECTS</div>
        <ul id="sublist">

        </ul>
        <hr />
        <div style="font-weight: bold;">GRADE LEVELS</div>
        <ul id="gradlist">

        </ul>
    </div>
    <div id="main-content" class="container"></div>

    <script src="js/libs/es5-shim/es5-shim.min.js"></script>
    <script src="js/libs/respond/respond.min.js"></script>
    <script src="js/libs/requirejs/require.min.js" data-main="js/main.min.js"></script>
    <script src="js/require-config.js"></script>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">
    $('#peek').on('dblclick', function() {
        var $this = $(this);
        if ($this.hasClass('open')) {
            $this.animate({
                left: '0px'
            }, 500).removeClass('open');
        } else {
            $this.animate({
                left: '-355px'
            }, 500).addClass('open');
        }
    });

    var isInIframe = true;
    try {
        var parentWindow = window.parent.document;

        $('#main-content.container', parentWindow).removeClass('container').addClass('container-fluid');
        $('#resource-content', parentWindow).css('width', '100%');
        $('#main-content.container').css('width', '100%');
        $('.wide-container.resources').css('width', '100%');
        $('.wide-container.resources').css('width', '100%');

        isInIframe = window.self !== window.top;
    } catch (err) {}

    // $.ajax({
    //     url: "http://zubu.cloudapp.net:8888/roles.json?ts=" + (new Date().getTime()),
    //     type: "GET",
    //     dataType: "json",
    //     success: function(data) {
    //         for (var obj in data) {
    //             var role = data[obj];
    //             if (isInIframe) {
    //                 $('#peek ul').append("<div><a class=\"lLink\" href=\"#\" onclick=\"$(parent.document).find('iframe').attr('src', '/resources/5048e5d0e5e7fb620900005d/public/index.html?role=" + role + "')\"; return false;'>" + decodeURI(role) + "</a></div>")
    //             } else {
    //                 var winloc = window.location.href.split('?')[0];
    //                 $('#peek ul').append("<div><a class='lLink' href='" + winloc + "?role=" + role + "'>" + decodeURI(role) + "</a></div>")
    //             }
    //         }
    //     },
    //     error: function(err) {}
    // });
    $.ajax({
        url: "http://zubu.cloudapp.net:8888/subjects.json?ts=" + (new Date().getTime()),
        type: "GET",
        dataType: "json",
        success: function(data) {
            if (data) {
                for (var objIndex in data.subjects) {
                    $("#sublist").append(
                        $("<li />").addClass("lLink").append($("<input />").attr("type", "checkbox").attr("name", "sub").attr("value", objIndex)).append(data.subjects[objIndex])
                    );
                }
                for (var objIndex in data.grades) {
                    $("#gradlist").append(
                        $("<li />").addClass("lLink").append($("<input />").attr("type", "checkbox").attr("name", "gra").attr("value", objIndex)).append(data.grades[objIndex])
                    );
                }
            }
        },
        error: function(err) {}
    });

    function refreshRec() {
        var sub = [];
        var gra = [];
        var obj = $("input").serializeArray();
        if (obj) {
            for (var objIndex in obj) {
                if (obj[objIndex].name == "sub") {
                    sub.push(obj[objIndex].value);
                } else {
                    gra.push(obj[objIndex].value);
                }
            }
        }
        var param = '?sub=[' + sub + ']&gra=[' + gra + ']';
        if (isInIframe) {
            $(parent.document).find('iframe').attr('src', '/resources/5048e5d0e5e7fb620900005d/public/index.html' + param)
        } else {
            var winloc = window.location.href.split('?')[0];
            window.location.href = winloc + param;
        }
    }
    </script>
</body>

</html>